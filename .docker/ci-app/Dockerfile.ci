FROM ruby:3.4-alpine
RUN apk add -U --no-cache --virtual build-dependencies \
      build-base \
      bash \
      curl \
      git \
      yaml \
      yaml-dev \
      libxslt-dev \
      libffi-dev \
      postgresql16-dev \
      nodejs \
      sqlite-dev \
      yarn tzdata shared-mime-info
RUN mkdir /app
WORKDIR /app
ENV RAILS_ENV='test'
RUN gem install bundler -v 2.5.9
COPY . .
RUN bundle install --jobs=4 --retry=3         # ensures any gems from local paths or git sources are installed
RUN ls config/*example | xargs -I{} echo {} |  cut -d '.' -f-2 | xargs -I{} cp {}.example {}
CMD ["bash"]
