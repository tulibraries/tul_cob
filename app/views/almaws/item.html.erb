<%# This template is replaces the initial load of availability information generated by catalog/physical_availability_card.html.erb %>
<%# Changes need to be in both places if they are document-related %>
<%# This template has access to @items returned by the alma api, so it has slightly different information that the other template %>
<%# Any changes related to the alma api should only be made here %>

<div id="request-url-data-<%= @mms_id %>" class="hidden" data-requests-url="<%= request_options_path(@mms_id, @pickup_locations, @request_level) %>"></div>
<% unless @document_availability.all?(&:empty?) %>
  <div class="availability-modal">
    <div class="modal-only">
      <button type="button" class="blacklight-modal-close close" data-dismiss="modal" aria-label="<%= t('blacklight.modal.close') %>">
        <span aria-hidden="true">&times;</span>
      </button>

      <%= render :partial => "paginate_compact", :object => @response %>
    </div>
  <% sort_order_for_holdings(@document_availability).each do |key, items| %>
    <div id="availability-container" class="m-0" data-controller="availability">
      <div class="modal-body d-lg-flex table-heading ml-0 mb-0 border-bottom border-top border-tan-border justify-content-lg-between">
        <div class="library-name card-title col-sm-12 col-lg-4"><%= library_name_from_short_code(key) %></div>
        <div class="holdings-summary"><%= summary_list(items) %></div>
        <div class="aeon-request" colspan="7"><%= aeon_request_button(@document) %></div>
      </div>

      <% items.each do |item| %>
        <div class="row avail-info-rows border-bottom border-tan-border">
          <div id="<%= location_name_from_short_code(item) %>" class="col-sm-12 col-md-2"><strong><%= location_status(item) %></strong></div>
          <div id="call_num" class="col-sm-12 col-md-2"><%= alternative_call_number(item) %></div>
          <div class="col-sm-12 col-md-5">
            <span id="description"><%= description(item) %></span>
            <span id="note"><%= public_note(item) %></span>
            <span id="material type"><%= material_type(item) %></span>
          </div>
          <div>
            <div id="status" class="col-sm-12"><%= item.fetch("availability", "") %></div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <%= render :partial => "paginate_compact", :object => @response %>

  <% else %>
    <div id: "error-message">We are unable to find availability information for this record. Please contact the library for more information.</div>
</div>
<% end %>
