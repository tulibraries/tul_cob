<% doc_presenter = show_presenter(document) %>

<% @response["response"][:docs].each_with_index do |field, i| %>
  <% if document.fetch("availability_facet", [])[i] == "Online" %>
    <% document_show_fields(document).each do |field_name, field| -%>
      <% if field_name == 'electronic_resource_display' %>
        <% if should_render_show_field? document, field %>
          <% if document[field_name].length == 1 %>
            <%= button_to "Online", single_link_builder(document[field_name][i]), class:"collapse-button btn btn-sm btn-info" %>
          <% else %>
            <button class="btn-block btn btn-sm btn-info collapse-button" data-toggle="collapse" data-target="#online-document-<%=  document_counter %>">Online</button>
            <div id="online-document-<%= document_counter %>" class="collapse online_resources">
              <ul>
                <%= doc_presenter.field_value field_name %>
              </ul>
            </div>
          <% end %>
        <% end -%>
      <% end -%>
    <% end -%>
  <% end %>

  <div class="row button-break"></div>

  <% if document.fetch("availability_facet", [])[i] == "At the Library" %>
    <button class="btn btn-sm btn-default availability-toggle-details collapse-button" data-toggle="collapse" data-target="#physical-document-<%=  document_counter %>">Loading...</button>
    <dd class="blacklight-availability availability-ajax-load" data-availability-ids="<%= document.alma_availability_mms_ids.join(',') %>" ></dd>
    <div id="physical-document-<%= document_counter %>" class="collapse">
    <div class="availability-details-container" data-availability-iframe-url="<%= alma_app_fulfillment_url(document) %>"></div>
  <% end %>
<% end %>
